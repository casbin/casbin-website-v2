---
id: log-error
title: Log & Error Handling
description: Logging and error handling in Casbin
keywords: [log, error, error handling]
authors: [hsluoyz]
---

## Logging

Casbin uses the built-in `log` package to print logs to the console by default, for example:

```log
2017/07/15 19:43:56 [Request: alice, data1, read ---> true]
```

Logging is not enabled by default. You can toggle it via `Enforcer.EnableLog()` or the last parameter of `NewEnforcer()`.

:::note
For Golang: Casbin supports logging the model, enforce request, role, and policy. You can define your own logger for Casbin.
:::

:::note
For Python: PyCasbin uses the default Python logging mechanism. PyCasbin calls `logging.getLogger()` to set the logger. No special logging configuration is needed other than initializing the logger in the parent application. If no logging is initialized, you will not see log messages from PyCasbin. When you enable logs in PyCasbin, you can specify the logging configuration through the `logging_config` parameter. If not specified, it uses the [default log configuration](https://github.com/casbin/pycasbin/blob/c33cabfa0ac65cd09cf812a65e71794d64cb5132/casbin/util/log.py#L6C1-L6C1). For Django users, refer to the [Django logging docs](https://docs.djangoproject.com/en/4.2/topics/logging/). For other Python users, refer to the [Python logging docs](https://docs.python.org/3/library/logging.config.html).
:::

### Use Different Loggers for Different Enforcers

Each enforcer can have its own logger, which can be changed at runtime.

You can use a custom logger via the last parameter of `NewEnforcer()`. If you use this way to initialize your enforcer, you don't need to use the enabled parameter because the logger's enabled field takes priority.

```go
// Set a default logger as enforcer e1's logger.
e1.SetLogger(&Log.DefaultLogger{})

// Set another logger as enforcer e2's logger.
e2.SetLogger(&YourOwnLogger)

// Set your logger when initializing enforcer e3.
e3, _ := casbin.NewEnforcer("examples/rbac_model.conf", a, logger)
```

#### Supported Loggers

We provide some loggers to help you log information.

```mdx-code-block
<Tabs groupId="langs">
<TabItem value="Go" label="Go" default>
```

| Logger                                                                                              | Author | Description                                                                                                                  |
|-----------------------------------------------------------------------------------------------------|--------|------------------------------------------------------------------------------------------------------------------------------|
| [Default logger (built-in)](https://github.com/casbin/casbin/blob/master/log/default_logger.go)    | Casbin | The default logger using Golang log.                                                                                         |
| [Zap logger](https://github.com/casbin/zap-logger)                                                    | Casbin | Uses [zap](https://github.com/uber-go/zap), provides JSON encoded logs, and you can customize more with your own zap-logger. |

```mdx-code-block
</TabItem>
<TabItem value="PHP" label="PHP">
```

| Logger                                                          | Author | Description                                                              |
|-----------------------------------------------------------------|--------|--------------------------------------------------------------------------|
| [psr3-bridge logger](https://github.com/php-casbin/psr3-bridge) | Casbin | Provides a [PSR-3](https://www.php-fig.org/psr/psr-3/) compliant bridge. |

```mdx-code-block
</TabItem>
</Tabs>
```

#### How to Write a Logger

Your logger should implement the [Logger](https://github.com/casbin/casbin/blob/master/log/logger.go#L20) interface.

| Method       | Type      | Description                               |
|--------------|-----------|-------------------------------------------|
| EnableLog()  | mandatory | Control whether to print the message.     |
| IsEnabled()  | mandatory | Show the current logger's enabled status. |
| LogModel()   | mandatory | Log info related to the model.            |
| LogEnforce() | mandatory | Log info related to enforcing.            |
| LogRole()    | mandatory | Log info related to the role.             |
| LogPolicy()  | mandatory | Log info related to the policy.           |

You can pass your custom `logger` to `Enforcer.SetLogger()`.

Here is an example of how to customize a logger for Golang:

```go
import (
    "fmt"
    "log"
    "strings"
)

// DefaultLogger is the implementation for a Logger using Golang log.
type DefaultLogger struct {
    enabled bool
}

func (l *DefaultLogger) EnableLog(enable bool) {
    l.enabled = enable
}

func (l *DefaultLogger) IsEnabled() bool {
    return l.enabled
}

func (l *DefaultLogger) LogModel(model [][]string) {
    if !l.enabled {
        return
    }
    var str strings.Builder
    str.WriteString("Model: ")
    for _, v := range model {
        str.WriteString(fmt.Sprintf("%v\n", v))
    }
    log.Println(str.String())
}

func (l *DefaultLogger) LogEnforce(matcher string, request []interface{}, result bool, explains [][]string) {
    if !l.enabled {
        return
    }
    var reqStr strings.Builder
    reqStr.WriteString("Request: ")
    for i, rval := range request {
        if i != len(request)-1 {
            reqStr.WriteString(fmt.Sprintf("%v, ", rval))
        } else {
            reqStr.WriteString(fmt.Sprintf("%v", rval))
        }
    }
    reqStr.WriteString(fmt.Sprintf(" ---> %t\n", result))
    reqStr.WriteString("Hit Policy: ")
    for i, pval := range explains {
        if i != len(explains)-1 {
            reqStr.WriteString(fmt.Sprintf("%v, ", pval))
        } else {
            reqStr.WriteString(fmt.Sprintf("%v \n", pval))
        }
    }
    log.Println(reqStr.String())
}

func (l *DefaultLogger) LogPolicy(policy map[string][][]string) {
    if !l.enabled {
        return
    }
    var str strings.Builder
    str.WriteString("Policy: ")
    for k, v := range policy {
        str.WriteString(fmt.Sprintf("%s : %v\n", k, v))
    }
    log.Println(str.String())
}

func (l *DefaultLogger) LogRole(roles []string) {
    if !l.enabled {
        return
    }
    log.Println("Roles: ", roles)
}
```

## Error Handling

Errors or panics may occur when you use Casbin for reasons such as:

1. Invalid syntax in the model file (.conf).
2. Invalid syntax in the policy file (.csv).
3. Custom errors from storage adapters, e.g., MySQL fails to connect.
4. Casbin's bug.

There are five main functions you may need to be aware of for errors or panics:

| Function                                                                       | Behavior on error |
|--------------------------------------------------------------------------------|-------------------|
| [NewEnforcer()](https://godoc.org/github.com/casbin/casbin#NewEnforcer)        | Returns an error  |
| [LoadModel()](https://godoc.org/github.com/casbin/casbin#Enforcer.LoadModel)   | Returns an error  |
| [LoadPolicy()](https://godoc.org/github.com/casbin/casbin#Enforcer.LoadPolicy) | Returns an error  |
| [SavePolicy()](https://godoc.org/github.com/casbin/casbin#Enforcer.SavePolicy) | Returns an error  |
| [Enforce()](https://godoc.org/github.com/casbin/casbin#Enforcer.Enforce)       | Returns an error  |

:::note
`NewEnforcer()` calls `LoadModel()` and `LoadPolicy()` internally. So you don't have to call the latter two when using `NewEnforcer()`.
:::
