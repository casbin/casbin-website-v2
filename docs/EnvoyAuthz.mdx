---
id: envoy
title: Authorization of Service Mesh through Envoy
description: Authorization of Service Mesh through Envoy
keywords: [Envoy, Envoy-authz, Istio]
authors: [ashish493]
---

[Envoy-authz](https://github.com/casbin/envoy-authz) is an Envoy middleware that provides external RBAC and ABAC authorization through Casbin. It integrates with [Envoy's external authorization API](https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/security/ext_authz_filter.html) via a gRPC server and can be deployed on any Envoy-based service mesh, including Istio.

## Prerequisites

- Envoy 1.17 or later
- Istio or another Envoy-based service mesh
- gRPC dependencies

Dependencies are managed through `go.mod`.

## How It Works

- A client initiates an HTTP request
- Envoy intercepts the request and forwards it to the gRPC authorization server
- The server evaluates the request against Casbin policies
- Authorized requests proceed; unauthorized requests are blocked

The gRPC server implements the protocol buffer definition from Envoy's [external_auth.proto](https://github.com/envoyproxy/envoy/blob/master/api/envoy/service/auth/v2alpha/external_auth.proto):

```protobuf
// A generic interface for performing authorization checks on incoming
// requests to a networked service.
service Authorization {
  // Performs an authorization check based on the attributes associated with the
  // incoming request and returns a status of `OK` or not `OK`.
  rpc Check(v2.CheckRequest) returns (v2.CheckResponse);
}
```

The authorization server must implement the `Check()` method defined above.

## Usage

- Configure your Casbin policies in the configuration files following the [Casbin documentation](/docs/how-it-works).

You can test your policies using the online [Casbin editor](/editor).

- Launch the authorization server:

```bash
go build .
./authz
```

- Apply the Envoy configuration:

```bash
envoy -c authz.yaml -l info
```

Once Envoy starts, it will route incoming requests through the authorization middleware.

## Integrating with Istio

To enable this middleware, configure your system to pass user identity information through custom headers in JWT tokens or request headers. For instructions on modifying request headers, consult the official [Istio documentation](https://istio.io/v1.4/docs/tasks/policy-enforcement/control-headers/).
