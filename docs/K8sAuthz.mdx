---
id: k8s
title: Authorization of Kubernetes
description: Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin
keywords: [Kubernetes authorization, Kubernetes RBAC, Kubernetes ABAC, K8s-authz]
authors: [hsluoyz]
---

[K8s-authz](https://github.com/casbin/k8s-authz) is a Kubernetes (k8s) authorization middleware based on Casbin that uses RBAC (Role-Based Access Control) and ABAC (Attribute-Based Access Control) for policy enforcement. This middleware integrates with the K8s validating admission webhook to enforce Casbin policies for each request made to K8s resources. Custom admission controllers are registered with Kubernetes using the `ValidatingAdmissionWebhook` to validate request objects forwarded by the API server and provide a response indicating whether the request should be allowed or rejected.

A validation webhook determines when to send incoming requests to the admission controller. This webhook proxies requests for any type of K8s resource or sub-resource and performs policy verification. Users are only allowed to perform operations on these resources if they are authorized by the Casbin enforcer. The [enforcer](/docs/get-started#new-a-casbin-enforcer) checks the user's roles as defined in the policies. The K8s cluster is the deployment target for this middleware.

## Requirements

Before proceeding, ensure you have the following:

- A running Kubernetes cluster. You can set up a local cluster using Docker or a full Kubernetes ecosystem on your server. For detailed instructions, refer to this [guide](https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/) for setting up a local cluster on Windows or this [guide](https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04) for Linux.
- Kubectl CLI. Installation instructions for Kubectl on Windows are [here](https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/), and for Linux [here](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/).
- OpenSSL

## Usage

Follow these steps to use K8s-authz:

1. Generate certificates and keys for each user using OpenSSL. Run:

    ```bash
    ./gen_cert.sh
    ```

2. Build the Docker image from the [Dockerfile](https://github.com/casbin/k8s-authz/blob/master/Dockerfile) by running:

    ```bash
    docker build -t casbin/k8s_authz:0.1 .
    ```
    (Change the build version in the command and in the deployment [file](https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18) as needed.)

3. Define Casbin policies in the [model.conf](https://github.com/casbin/k8s-authz/blob/master/config/model.conf) and [policy.csv](https://github.com/casbin/k8s-authz/blob/master/config/policy.csv) files. For more information, see the [documentation](/docs/how-it-works).

4. Before deploying, you can modify the ports in [main.go](https://github.com/casbin/k8s-authz/blob/master/main.go) and in the validation webhook configuration [file](https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml) as needed.

5. Deploy the validation controller and webhook on the Kubernetes cluster:

    ```bash
    kubectl apply -f deployment.yaml
    ```

6. For production, create a Kubernetes `secret` to secure the certificates:

    ```bash
    kubectl create secret generic casbin -n default \
      --from-file=key.pem=certs/casbin-key.pem \
      --from-file=cert.pem=certs/casbin-crt.pem
    ```

7. After completing the above steps, update the certificate directory in [main.go](https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26) and the [manifests](https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22) with the directory of the created `secret`.

Now, the server should be up and running, ready to validate requests made to K8s resources and enforce policies accordingly.
