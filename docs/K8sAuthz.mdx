---
id: k8s
title: Authorization of Kubernetes
description: Kubernetes (k8s) RBAC & ABAC authorization middleware based on Casbin
keywords: [Kubernetes authorization, Kubernetes RBAC, Kubernetes ABAC, K8s-authz]
authors: [hsluoyz]
---

[K8s-authz](https://github.com/casbin/k8s-authz) is a Kubernetes authorization middleware built on Casbin that implements RBAC (Role-Based Access Control) and ABAC (Attribute-Based Access Control) policy enforcement. This middleware integrates with the Kubernetes validation admission webhook to evaluate Casbin-defined policies against each request to Kubernetes resources. Custom admission controllers register with Kubernetes using `ValidatingAdmissionWebhook` to validate request objects forwarded by the API server and return allow or deny responses.

The validation webhook proxies requests for all Kubernetes resource types and subresources, performing policy verification for each. Users can perform operations on resources only when authorized by the Casbin enforcer. The [enforcer](/docs/get-started#new-a-casbin-enforcer) evaluates user roles as defined in the policies. Deploy this middleware directly to your Kubernetes cluster.

## Prerequisites

Before you begin, ensure you have:

- A running Kubernetes cluster. Set up a local cluster using Docker or establish a complete Kubernetes environment on your server. For local setup on Windows, see [this guide](https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/). For Linux server setup, see [this tutorial](https://www.digitalocean.com/community/tutorials/how-to-create-a-kubernetes-cluster-using-kubeadm-on-ubuntu-18-04).
- Kubectl CLI. Installation instructions: [Windows](https://kubernetes.io/docs/tasks/tools/install-kubectl-windows/) | [Linux](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/)
- OpenSSL

## Usage

Follow these steps to configure K8s-authz:

1. Generate certificates and keys for each user using OpenSSL. Run:

    ```bash
    ./gen_cert.sh
    ```

2. Build the Docker image from the [Dockerfile](https://github.com/casbin/k8s-authz/blob/master/Dockerfile) manually. Update the version number in both the command and the deployment [file](https://github.com/casbin/k8s-authz/blob/718f58c46e3dbf79063b5b1c18348c2fee5de9e9/manifests/deployment.yaml#L18):

    ```bash
    docker build -t casbin/k8s_authz:0.1 .
    ```

3. Define Casbin policies in [model.conf](https://github.com/casbin/k8s-authz/blob/master/config/model.conf) and [policy.csv](https://github.com/casbin/k8s-authz/blob/master/config/policy.csv) files. For policy configuration details, see the [documentation](/docs/how-it-works).

4. (Optional) Modify ports in [main.go](https://github.com/casbin/k8s-authz/blob/master/main.go) and the validation webhook configuration [file](https://github.com/casbin/k8s-authz/blob/master/manifests/deployment.yaml) according to your requirements.

5. Deploy the validation controller and webhook to the Kubernetes cluster:

    ```bash
    kubectl apply -f deployment.yaml
    ```

6. For production environments, create a Kubernetes `secret` to secure certificates:

    ```bash
    kubectl create secret generic casbin -n default \
      --from-file=key.pem=certs/casbin-key.pem \
      --from-file=cert.pem=certs/casbin-crt.pem
    ```

7. Update the certificate directory paths in [main.go](https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/main.go#L26) and the [manifests](https://github.com/ashish493/k8s-authz/blob/3560551427c0431a9d4594ad1206f084ede37c49/manifests/deployment.yaml#L22) to reference the created `secret`.

The server should now be operational, validating requests to Kubernetes resources and enforcing policies.
