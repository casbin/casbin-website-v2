---
id: adapters
title: Adapters
description: Comprehensive guide to Casbin policy storage adapters, including supported databases, implementation examples, and integration best practices
keywords: [Casbin adapters, storage adapters, database adapters, policy persistence, third-party adapters]
authors: [hsluoyz]
---

In Casbin, policy storage is managed by adapters—middleware components that handle policy rule loading (`LoadPolicy()`) and persistence (`SavePolicy()`). To keep the core library lightweight, adapter implementations are maintained as separate packages.

## Supported Adapters

Below is a comprehensive list of Casbin adapters. Third-party contributions of new adapters are welcome—please notify us to have your implementation added to this list:

```mdx-code-block
<Tabs groupId="langs">
<TabItem value="Go" label="Go" default>

import {AdapterDotNETData} from "@site/src/tableData/AdapterData/AdapterDotNETData";
import {AdapterGoData} from "@site/src/tableData/AdapterData/AdapterGoData";
import {AdapterJavaData} from "@site/src/tableData/AdapterData/AdapterJavaData";
import {AdapterLuaData} from "@site/src/tableData/AdapterData/AdapterLuaData";
import AdapterMDTable from "@site/src/tableData/AdapterData/AdapterMDTable";
import {AdapterNodejsData} from "@site/src/tableData/AdapterData/AdapterNodejsData";
import {AdapterPhpData} from "@site/src/tableData/AdapterData/AdapterPhpData";
import {AdapterPythonData} from "@site/src/tableData/AdapterData/AdapterPythonData";
import {AdapterRubyData} from "@site/src/tableData/AdapterData/AdapterRubyData";
import {AdapterRustData} from "@site/src/tableData/AdapterData/AdapterRustData";
import {AdapterSwiftData} from "@site/src/tableData/AdapterData/AdapterSwiftData";

<AdapterMDTable data={AdapterGoData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Java" label="Java">

<AdapterMDTable data={AdapterJavaData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Node.js" label="Node.js">

<AdapterMDTable data={AdapterNodejsData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="PHP" label="PHP">

<AdapterMDTable data={AdapterPhpData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Python" label="Python">

<AdapterMDTable data={AdapterPythonData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value=".NET" label=".NET">

<AdapterMDTable data={AdapterDotNETData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Rust" label="Rust">

<AdapterMDTable data={AdapterRustData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Ruby" label="Ruby">

<AdapterMDTable data={AdapterRubyData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Swift" label="Swift">

<AdapterMDTable data={AdapterSwiftData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
<TabItem value="Lua" label="Lua">

<AdapterMDTable data={AdapterLuaData}></AdapterMDTable>
```

```mdx-code-block
</TabItem>
</Tabs>
```

:::note

1. When `casbin.NewEnforcer()` is called with an explicit or implicit adapter, policies load automatically during initialization.
2. Use `e.LoadPolicy()` to manually reload policies from storage after making external changes.
3. Adapters may not support automatic policy persistence. After modifying policies (e.g., via `AddPolicy()`), call `e.SavePolicy()` explicitly to persist changes.

:::

## Examples

### Built-in File Adapter Example

Here's how to initialize an Enforcer using the built-in file adapter:

```mdx-code-block
<Tabs groupId="langs">
<TabItem value="Go" label="Go" default>
```

```go
import (
    "fmt"
    "github.com/casbin/casbin"
)

e, err := casbin.NewEnforcer("examples/basic_model.conf", "examples/basic_policy.csv")
if err != nil {
    fmt.Printf("Failed to create enforcer: %v", err)
    return
}
```

```mdx-code-block
</TabItem>
<TabItem value="PHP" label="PHP">
```

```php
use Casbin\Enforcer;

$e = new Enforcer('examples/basic_model.conf', 'examples/basic_policy.csv');
```

```mdx-code-block
</TabItem>
<TabItem value="Rust" label="Rust">
```

```rust
use casbin::prelude::*;

let mut e = Enforcer::new("examples/basic_model.conf", "examples/basic_policy.csv").await?;
```

```mdx-code-block
</TabItem>
</Tabs>
```

This is equivalent to:

```mdx-code-block
<Tabs groupId="langs">
<TabItem value="Go" label="Go" default>
```

```go
import (
    "github.com/casbin/casbin"
    "github.com/casbin/casbin/file-adapter"
)

a := fileadapter.NewAdapter("examples/basic_policy.csv")
e := casbin.NewEnforcer("examples/basic_model.conf", a)
```

```mdx-code-block
</TabItem>
<TabItem value="PHP" label="PHP">
```

```php
use Casbin\Enforcer;
use Casbin\Persist\Adapters\FileAdapter;

$a = new FileAdapter('examples/basic_policy.csv');
$e = new Enforcer('examples/basic_model.conf', $a);
```

```mdx-code-block
</TabItem>
<TabItem value="Rust" label="Rust">
```

```rust
use casbin::prelude::*;
use casbin::file_adapter::FileAdapter;

let a = FileAdapter::new("examples/basic_policy.csv");
```

```mdx-code-block
</TabItem>
</Tabs>
```

### [MySQL Adapter](https://github.com/casbin/mysql-adapter)

The following example initializes an enforcer from a MySQL database, connecting to 127.0.0.1:3306 with username `root` and empty password:

```mdx-code-block
<Tabs groupId="langs">
<TabItem value="Go" label="Go" default>
```

```go
import (
    "github.com/casbin/casbin"
    "github.com/casbin/mysql-adapter"
)

a := mysqladapter.NewAdapter("mysql", "root:@tcp(127.0.0.1:3306)/")
e := casbin.NewEnforcer("examples/basic_model.conf", a)
```

```mdx-code-block
</TabItem>
<TabItem value="Rust" label="Rust">
```

```rust
// https://github.com/casbin-rs/diesel-adapter
// Make sure to activate the `mysql` feature

use casbin::prelude::*;
use diesel_adapter::{ConnOptions, DieselAdapter};

let mut conn_opts = ConnOptions::default();
conn_opts
    .set_hostname("127.0.0.1")
    .set_port(3306)
    .set_host("127.0.0.1:3306") // Overwrites hostname and port configuration
    .set_database("casbin")
    .set_auth("casbin_rs", "casbin_rs");

let a = DieselAdapter::new(conn_opts)?;
let mut e = Enforcer::new("examples/basic_model.conf", a).await?;
```

```mdx-code-block
</TabItem>
<TabItem value="PHP" label="PHP">
```

```php
// https://github.com/php-casbin/dbal-adapter

use Casbin\Enforcer;
use CasbinAdapter\DBAL\Adapter as DatabaseAdapter;

$config = [
    // Either 'driver' with one of the following values:
    // pdo_mysql,pdo_sqlite,pdo_pgsql,pdo_oci (unstable),pdo_sqlsrv,pdo_sqlsrv,
    // mysqli,sqlanywhere,sqlsrv,ibm_db2 (unstable),drizzle_pdo_mysql
    'driver'     => 'pdo_mysql',
    'host' => '127.0.0.1',
    'dbname' => 'test',
    'user' => 'root',
    'password' => '',
    'port' => '3306',
];

$a = DatabaseAdapter::newAdapter($config);
$e = new Enforcer('examples/basic_model.conf', $a);
```

```mdx-code-block
</TabItem>
</Tabs>
```

## Use Your Own Storage Adapter

You can use a custom adapter like this:

```go
import (
    "github.com/casbin/casbin"
    "github.com/your-username/your-repo"
)

a := yourpackage.NewAdapter(params)
e := casbin.NewEnforcer("examples/basic_model.conf", a)
```

## Migrate/Convert Between Different Adapters

To convert policies between adapters (from Adapter A to Adapter B):

1. Load policies from Adapter A into memory:
   ```go
   e, _ := NewEnforcer(m, A)
   ```
   or
   ```go
   e.SetAdapter(A)
   e.LoadPolicy()
   ```

2. Switch to Adapter B:
   ```go
   e.SetAdapter(B)
   ```

3. Save policies from memory to Adapter B:
   ```go
   e.SavePolicy()
   ```

## Load/Save at Runtime

You may need to reload the model, reload policies, or save policies after initialization:

```go
// Reload the model from the model CONF file.
e.LoadModel()

// Reload policies from file/database.
e.LoadPolicy()

// Save current policies (usually after changes via Casbin API) back to storage.
e.SavePolicy()
```

## Auto-Save Feature

The **Auto-Save** feature allows adapters to automatically persist individual policy changes (add/remove) instead of requiring a full `SavePolicy()` call. This improves performance for large policy sets by avoiding full policy overwrites.

:::note

1. Auto-Save is optional—adapters may choose to implement it or not.
2. Auto-Save only works when the enforcer's adapter supports it.
3. Check the **AutoSave** column in the adapter list above to verify support.

:::

Here's how to use Auto-Save:

```go
import (
    "github.com/casbin/casbin"
    "github.com/casbin/xorm-adapter"
    _ "github.com/go-sql-driver/mysql"
)

// Auto-Save is enabled by default for supporting adapters.
a := xormadapter.NewAdapter("mysql", "mysql_username:mysql_password@tcp(127.0.0.1:3306)/")
e := casbin.NewEnforcer("examples/basic_model.conf", a)

// Disable Auto-Save.
e.EnableAutoSave(false)

// Policy changes only affect in-memory policies (not storage).
e.AddPolicy(...)
e.RemovePolicy(...)

// Re-enable Auto-Save.
e.EnableAutoSave(true)

// Policy changes now persist to storage automatically.
e.AddPolicy(...)
e.RemovePolicy(...)
```

For more examples, see the [xorm-adapter tests](https://github.com/casbin/xorm-adapter/blob/master/adapter_test.go).

### How to Write an Adapter

All adapters must implement the [Adapter](https://github.com/casbin/casbin/blob/master/persist/adapter.go) interface with these methods:

| Method                 | Required | Description                                                |
|------------------------|----------|------------------------------------------------------------|
| `LoadPolicy()`         | Yes      | Load all policy rules from storage                          |
| `SavePolicy()`         | Yes      | Save all policy rules to storage                            |
| `AddPolicy()`          | No       | Add a single policy rule to storage (for Auto-Save)        |
| `RemovePolicy()`       | No       | Remove a single policy rule from storage (for Auto-Save)   |
| `RemoveFilteredPolicy()`| No       | Remove policy rules matching a filter (for Auto-Save)      |

:::note

Adapters not supporting Auto-Save should provide empty implementations for optional methods:

:::

```go
// AddPolicy adds a policy rule to the storage.
func (a *Adapter) AddPolicy(sec string, ptype string, rule []string) error {
    return errors.New("not implemented")
}

// RemovePolicy removes a policy rule from the storage.
func (a *Adapter) RemovePolicy(sec string, ptype string, rule []string) error {
    return errors.New("not implemented")
}

// RemoveFilteredPolicy removes policy rules that match the filter from the storage.
func (a *Adapter) RemoveFilteredPolicy(sec string, ptype string, fieldIndex int, fieldValues ...string) error {
    return errors.New("not implemented")
}
```

Casbin ignores "not implemented" errors for optional methods.

### Adapter Implementation Guidelines

When creating an adapter, follow these conventions:

- **Data Structure**: Support at least six columns for policy rules.
- **Database Name**: Use `casbin` as the default database name.
- **Table Name**: Use `casbin_rule` as the default table name.
- **Ptype Column**: Name this column `ptype` (not `p_type` or `Ptype`).
- **Table Schema**: Use `(id int primary key, ptype varchar, v0 varchar, v1 varchar, v2 varchar, v3 varchar, v4 varchar, v5 varchar)`.
- **Unique Index**: Create a unique index on `(ptype, v0, v1, v2, v3, v4, v5)`.
- **Filtered Loading**: Implement `LoadFilteredPolicy` with filter parameters like:
  ```json
  {
      "p": [ ["alice"], ["bob"] ],
      "g": [ ["", "book_group"], ["", "pen_group"] ],
      "g2": [ ["alice"] ]
  }
  ```

### Database Creation Responsibility

Adapters should automatically create the `casbin` database if it doesn't exist. Refer to the [Xorm adapter](https://github.com/casbin/xorm-adapter) for a reference implementation.

## Context-Aware Adapters

[ContextAdapter](https://github.com/casbin/casbin/blob/master/persist/adapter_context.go) provides context support for adapters, enabling features like timeout control for database operations.

### Example Usage

The [gorm-adapter](https://github.com/casbin/gorm-adapter) supports context-aware operations. Here's a timeout example:

```go
ca, _ := NewContextAdapter("mysql", "root:@tcp(127.0.0.1:3306)/", "casbin")
// Set 300ms timeout
ctx, cancel := context.WithTimeout(context.Background(), 300*time.Millisecond)
defer cancel()

err := ca.AddPolicyCtx(ctx, "p", "p", []string{"alice", "data1", "read"})
if err != nil {
    panic(err)
}
```

### How to Implement a Context-Aware Adapter

ContextAdapter extends the basic Adapter interface with context parameters for all methods. Implement context handling logic (like timeouts) while maintaining compatibility with the core Adapter interface. See [gorm-adapter's implementation](https://github.com/casbin/gorm-adapter/blob/master/adapter.go) for reference.
