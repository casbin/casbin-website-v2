---
id: performance
title: 性能优化
description: 性能优化
keywords:
  - 优化
authors:
  - hsluoyz
---

当应用于数以百万计的用户或权限的生产环境时，您可能会在Casbin 的强制执行中遇到性能降级，通常有两个原因：

#### 高访问量

每秒到来的请求数量非常庞大，例如：单个Casbin实例每秒就能收到10000条请求。 在这种情况下，仅靠一个Casbin实例通常难以处理完所有请求。 现在有两种解决方案：

1. 运用多线程来运行多个Casbin实例，这样以来您就可以充分利用机器中的所有内核。 详情请参阅：[多线程](/docs/multi-threading)

2. 将Casbin实例部署到机器集群(多台机器)。 使用Watcher来确保所有Casbin实例运行一致。 详情请参阅： [Watcher](/docs/watchers)。

:::note

您可以同时使用上述方法，例如将Casbin部署到10台机群。 每台机器同时具有5个线程来满足Casbin强制执行请求。

:::

#### 大量的策略规则

在云或多租户环境中，可能需要数百万条策略规则。 每次执行请求甚至是在最初期加载策略规则的速度非常缓慢。 这类事件通常可以通过以下几种方式缓解：

1. 您的Casbin模型或规则设计得不够好。 精致的模型和策略将抽象每个用户/租户的重复逻辑，并将规则的数量减少到一个非常小的级别(< 100)： 例如：您可以在所有租户之间分享一些默认规则，让用户稍后自定义他们的规则。 自定义规则可以覆盖默认规则。 如果您仍然有疑问，请将GitHub issue发送到Casbin报告。

2. 通过共享让Casbin 的执行者只需要加载一套小套策略规则，例如：enforcer_0 只为tenant_0 到tenant_99提供服务, enforcer_1 只为tenant_100到tenant_199提供服务。 只需要加载所有策略规则的一部分，详情请参阅 ：[策略子集加载](/docs/policy-subset-loading) 。

3. 以授予RBAC角色权限，取代直接授予用户权限。 Casbin的RBAC是通过角色继承树来实现的(作为缓存)。 因此授予类似Alice这样的用户权限，Casbin只使用O(1) 时间查询RBAC树来获取角色用户关系并执行操作。 如果您的 g 规则不会经常改变，那么RBAC 树将不需要进行更新。 详情请参阅这条讨论: https://github.com/casbin/casbin/issues/681#issuecomment-763801583

:::note

您可以同时尝试以上的方法。

:::
