---
id: performance
title: Оптимизация производительности
description: Casbin performance optimization
keywords:
  - optimization
authors:
  - hsluoyz
---

Когда вы применяете в производственных условиях с миллионами пользователей или разрешений, вы можете столкнуться с понижением производительности в правоприменительной деятельности в Касбине, как правило, существуют две причины:

#### Высокое громкость трафика

Количество запросов в секунду слишком велико, например, 10 000 запросов/с для одного экземпляра Casbin. В таком случае одиночного экземпляра Касбина, как правило, недостаточно для обработки всех запросов. Существует 2 возможных решения:

1. Используйте несколько нитей для включения нескольких экземпляров Касбин, так что вы можете в полной мере использовать все ядра на машине. Подробнее на сайте [Многопоточность](/docs/multi-threading).

2. Разверните экземпляры Casbin в кластер (несколько машин). Используйте Watcher для обеспечения согласованности всех случаев Касбина. Подробнее на сайте [Наблюдатели](/docs/watchers).

::note

Вы можете использовать вышеперечисленные методы, как в то же время, например, установить Casbin на 10-машинный кластер. Каждая машина имеет пять потоков одновременно для обслуживания Касбин просьб о принудительной реализации.

:::

#### Высокое количество правил политики

Миллионы правил политики могут потребоваться в облачной или многоквартирной среде. Каждый вызов или даже загрузка политических правил в первоначальное время является очень медленным. Такие случаи, как правило, могут быть смягчены несколькими способами:

1. Ваша модель или политика Касбина не хорошо разработана. Хорошо написанная модель и политика будут абстрагировать дублированную логику для каждого пользователя/арендатора и уменьшить количество правил до очень небольшого уровня (< 100): e. ., вы можете поделиться некоторыми правилами по умолчанию для всех арендаторов и позволить пользователям изменить их правила позже. Настраиваемые правила могут переопределить правила по умолчанию. Если у вас все еще есть вопрос, пожалуйста, отправьте запрос GitHub в репозиторий Casbin.

2. Делайте так, чтобы усилитель Касбина загружал только небольшой набор правил политики, напр. enforcer_0 служит только для арендатора от 0 до арендатора, 99, enforcer_1 служит только для арендатора от 100 до арендатора. Для загрузки только подмножества всех правил политики смотрите подробнее на сайте: [Загрузка подмножества политик](/docs/policy-subset-loading).

3. Предоставить права доступа ролям RBAC вместо непосредственных пользователей. RBAC в Casbin's реализован с помощью дерева ролей в качестве кэша. Так что данный пользователь, как Alice, Casbin использует только O(1) время для запроса дерева RBAC для отношений между пользователями и выполнения правоприменения. Если ваши правила g не часто меняются, то обновление дерева RBAC не требуется. См. подробности на этом dicussion: https://github.com/casbin/casbin/issues/681#issuecomment-763801583

::note

Вы можете попробовать все вышеперечисленные методы одновременно.

:::
